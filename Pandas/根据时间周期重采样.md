# 根据时间周期重采样

## pandas.date_range()

该函数是一个非常有用的函数，用于生成固定频率的日期时间索引，既DatetimeIndex对象。

一些用法案例：

使用start参数和end参数，规定数据的时间范围，默认的频率是1天。

```python
>>> df = pd.date_range(start='2024-09-01', end='2024-09-10')
DatetimeIndex(['2024-09-01', '2024-09-02', '2024-09-03', '2024-09-04',
               '2024-09-05', '2024-09-06', '2024-09-07', '2024-09-08',
               '2024-09-09', '2024-09-10'],
              dtype='datetime64[ns]', freq='D')
```

使用start参数和periods参数，规定数据的时间范围和周期，默认的频率是1天。

```python
>>> df = pd.date_range(start='2024-09-01', periods=10)
DatetimeIndex(['2024-09-01', '2024-09-02', '2024-09-03', '2024-09-04',
               '2024-09-05', '2024-09-06', '2024-09-07', '2024-09-08',
               '2024-09-09', '2024-09-10'],
              dtype='datetime64[ns]', freq='D')
```

freq参数为'B'时，频率为工作日

```python
>>> df = pd.date_range(start='2024-09-01', periods=10, freq='B')
DatetimeIndex(['2024-09-02', '2024-09-03', '2024-09-04', '2024-09-05',
               '2024-09-06', '2024-09-09', '2024-09-10', '2024-09-11',
               '2024-09-12', '2024-09-13'],
              dtype='datetime64[ns]', freq='B')
```

freq参数为'h'时，频率为每小时

```python
>>> df = pd.date_range(start='2024-09-01', periods=10, freq='h')
DatetimeIndex(['2024-09-01 00:00:00', '2024-09-01 01:00:00',
               '2024-09-01 02:00:00', '2024-09-01 03:00:00',
               '2024-09-01 04:00:00', '2024-09-01 05:00:00',
               '2024-09-01 06:00:00', '2024-09-01 07:00:00',
               '2024-09-01 08:00:00', '2024-09-01 09:00:00'],
              dtype='datetime64[ns]', freq='h')
```

## pandas.to_datetime()

该函数是 Pandas 库中用于将参数转换为 `datetime` 类型（或 `datetime64[ns]` 类型，这是 Pandas 内部的日期时间表示）的一个非常灵活和强大的函数。这个函数可以处理多种格式的日期时间字符串、列表、元组、数组等，将它们转换为 Pandas 可以方便处理的日期时间格式。

一些案例：

直接传入字符串

```python
>>> date_time = pd.to_datetime('2023-09-23')
Timestamp('2023-09-23 00:00:00')
```

传入字符串的format参数，会显著提高性能

```python
date_time = pd.to_datetime('202409241421', format='%Y%m%d%H%M')
Timestamp('2024-09-24 14:21:00')
```

传入一个列表

```python
>>> date_time = pd.to_datetime(['2023-09-01', '2023-09-02', '2023-09-03'])
DatetimeIndex(['2023-09-01', '2023-09-02', '2023-09-03'], dtype='datetime64[ns]', freq=None)
``` 

## pandas.DataFrame.resample()

这个函数是pandas中专门用来对时间序列数据进行重采样的函数，是一个非常重要的函数。
当你需要对时间进行分组和聚合时，这个函数就非常有用。

案例：

比如我们这里有一些分钟级别的k线数据，没条数据包含时间，开盘价，收盘价，最高价，最低价。

```python
>>> df
	open	high	low	close
datetime				
2024-09-23 14:18:00	13111.922509	13114.640577	13111.894295	13111.900448
2024-09-23 14:17:00	13132.668735	13134.199363	13111.430234	13111.897501
2024-09-23 14:16:00	13143.613528	13148.341592	13129.902927	13129.921181
2024-09-23 14:15:00	13142.297428	13144.063836	13139.114381	13143.597586
2024-09-23 14:14:00	13136.879469	13143.821937	13134.162270	13142.295142
...	...	...	...	...
2024-09-10 14:38:00	13263.700000	13268.600000	13263.700000	13264.700000
2024-09-10 14:37:00	13269.500000	13269.500000	13262.600000	13263.700000
2024-09-10 14:36:00	13269.500000	13272.400000	13269.500000	13269.600000
2024-09-10 14:35:00	13264.600000	13272.300000	13264.600000	13269.500000
2024-09-10 14:34:00	13264.600000	13267.500000	13260.700000	13264.600000
3000 rows × 4 columns
```

我们现在通过resample函数，将其合成5分钟k线
其中，还使用了agg函数，指定聚合规则
open字段取第一个值，high字段取最大值，low字段取最小值，close字段取最后一个值

```python
>>> new_df = df.resample('5min').agg({
        "open":"first",
        "high":"max",
        "low":"min",
        "close":"last"
    })
>>> new_df.dropna(inplace=True)
>>> new_df
	open	high	low	close
datetime				
2024-09-10 14:30:00	13264.600000	13267.500000	13260.700000	13264.600000
2024-09-10 14:35:00	13264.600000	13272.400000	13259.100000	13259.100000
2024-09-10 14:40:00	13259.100000	13259.100000	13250.400000	13250.900000
2024-09-10 14:45:00	13250.900000	13253.800000	13240.300000	13244.000000
2024-09-10 14:50:00	13244.000000	13250.000000	13240.700000	13240.700000
...	...	...	...	...
2024-09-23 13:55:00	13153.860777	13153.860777	13140.709119	13145.661106
2024-09-23 14:00:00	13144.130588	13146.159580	13134.181065	13137.367495
2024-09-23 14:05:00	13137.392358	13143.402016	13126.056775	13136.851226
2024-09-23 14:10:00	13134.174286	13143.821937	13129.464321	13142.295142
2024-09-23 14:15:00	13142.297428	13148.341592	13111.430234	13111.900448
601 rows × 4 columns
```

我们现在通过resample函数，将其合成日k线

```python
>>> new_df = df.resample('D').agg({
        "open":"first",
        "high":"max",
        "low":"min",
        "close":"last"
    })
>>> new_df.dropna(inplace=True)
>>> new_df
	open	high	low	close
datetime				
2024-09-10	13264.600000	13272.400000	13076.000000	13151.800000
2024-09-11	13151.800000	13340.100000	13102.900000	13331.500000
2024-09-12	13331.500000	13434.500000	13331.500000	13386.900000
2024-09-13	13386.900000	13410.900000	13299.300000	13361.700000
2024-09-18	13348.600000	13404.600000	13295.700000	13372.400000
2024-09-19	13375.300000	13479.800000	13320.800000	13432.000000
2024-09-20	13432.000000	13475.500000	13226.047513	13227.892461
2024-09-21	13227.893947	13233.142949	13182.025872	13197.997143
2024-09-23	13197.486284	13207.839785	13111.430234	13111.900448
```

## 频率字段可选值

min - 分钟频率，例子：5min 10min
s - 秒频率，例子：5s 10s
ms - 毫秒频率
us - 微秒频率
ns - 纳秒频率
h - 小时频率
D - 天频率
B - 工作日频率
W - 星期频率
MS ME - 月初频率 或 月末频率
QS QE - 季度频率 或 季度末频率
YS YE - 年频率 或 年末频率
